/**
 * Created by rahul on 16/7/16.
 */
var q = require("q");
var CACHE = null;
var mongoclient = require("mongodb").MongoClient;

//rgetting URL after providing db name
var config = require("./config");

var DB = function(dbname){
    dbName = (dbname != undefined) ? dbname : "hellodb";
}

DB.prototype.insert = function(doc,coll){
    return getDbInstance(dbName).then(function (db) {
        var A = q.defer();
        db.collection(collection).insert(doc, function(err, res){
          if(err){
              A.reject("Problem with Query" + err.message);
          }
            A.resolve(res);
        })
        return A.promise;
    })
}

function getDbInstance(dbname){
    var p = q.defer();
    if(CACHE != null ){
        p.resolve(CACHE);
    }
    require("mongodb").MongoClient.connect(config(dbname),function (err, db){
    //mongoClient.connect(config(dbname),function (err, db) {
        if(err){
            throw Error("Error Connecting !!");
        }
        CACHE = db;
        P.resolve();
    })
    return P.promise;
}

module.exports = DB;